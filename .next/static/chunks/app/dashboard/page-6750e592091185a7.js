(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{3351:function(e,t,s){Promise.resolve().then(s.bind(s,5823))},5823:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var n=s(7437),a=s(2265),l=s(2710),i=s(6463),o=s(8726);let c="rt_username",r="anon-chat-public",u=["Swift","Bright","Cool","Lucky","Calm","Brave","Quick","Kind","Sharp","Bold","Happy","Silent"],d=["Tiger","Falcon","Panda","Otter","Wolf","Eagle","Fox","Dolphin","Koala","Lion","Hawk","Bear"];function m(e){if(e<=0)return 0;if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues){let t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]%e}return Math.floor(Math.random()*e)}function h(){let e=(0,l.s)(),t=(0,i.useRouter)(),[s,h]=(0,a.useState)("chat"),[v,x]=(0,a.useState)("active"),[f,b]=(0,a.useState)("users"),[j,N]=(0,a.useState)(""),[p,y]=(0,a.useState)("23"),[g,C]=(0,a.useState)(!1),[S,k]=(0,a.useState)(null),[P,B]=(0,a.useState)([]),[A,I]=(0,a.useState)(null),[R,T]=(0,a.useState)(null),[E,w]=(0,a.useState)([]),[Z,M]=(0,a.useState)(""),[H,L]=(0,a.useState)(!1),[O,D]=(0,a.useState)(0),[U,_]=(0,a.useState)(!1),J=(0,a.useRef)(""),V=(0,a.useMemo)(()=>(null!=j?j:"").trim(),[j]),F=(0,a.useMemo)(()=>(null!=p?p:"").trim(),[p]);(0,a.useEffect)(()=>{var e;let t=null!==(e=localStorage.getItem(c))&&void 0!==e?e:"";if(t){N(e=>e||t);return}let s=function(){let e=u[m(u.length)],t=d[m(d.length)],s=(1e3+m(9e3)).toString();return"Guest-".concat(e,"-").concat(t,"-").concat(s)}();localStorage.setItem(c,s),N(s)},[]);let z=(0,a.useMemo)(()=>Array.isArray(P)?V?P.filter(e=>e!==V):P:[],[P,V]);(0,a.useEffect)(()=>{let t=()=>C(!0),s=()=>C(!1);return e.on("connect",t),e.on("disconnect",s),C(!!(null==e?void 0:e.connected)),()=>{e.off("connect",t),e.off("disconnect",s)}},[e]),(0,a.useEffect)(()=>{var t;let s=()=>{var t;return k(null!==(t=e.id)&&void 0!==t?t:null)},n=()=>k(null);return e.on("connect",s),e.on("disconnect",n),k(null!==(t=e.id)&&void 0!==t?t:null),()=>{e.off("connect",s),e.off("disconnect",n)}},[e]);let K=(0,a.useCallback)(()=>{V&&(localStorage.setItem(c,V),e.emit("user:register",{username:V}),e.emit("users:list"))},[V,e]),W=(0,a.useCallback)(e=>{e.preventDefault(),K()},[K]);(0,a.useEffect)(()=>{g&&V&&J.current!==V&&(J.current=V,K())},[g,V,K]),(0,a.useEffect)(()=>{g&&V&&e.emit("users:list")},[g,V,e]),(0,a.useEffect)(()=>{let t=e=>{let t=Array.isArray(null==e?void 0:e.details)?e.details:[];Array.isArray(null==e?void 0:e.users)?B(e.users):t.length?B(t.map(e=>e.username).filter(Boolean)):B([])};return e.on("users:update",t),()=>{e.off("users:update",t)}},[e]);let[q,G]=(0,a.useState)([]);(0,a.useEffect)(()=>{let t=e=>{G(Array.isArray(null==e?void 0:e.rooms)?e.rooms:[])};return e.on("rooms:update",t),e.emit("rooms:list"),()=>{e.off("rooms:update",t)}},[e]),(0,a.useEffect)(()=>{let t=e=>{(null==e?void 0:e.room)&&e.room===A&&w(t=>[...t,e])};return e.on("chat:message",t),()=>{e.off("chat:message",t)}},[A,e]),(0,a.useEffect)(()=>{let s=t=>{let{room:s}=t;L(!1),s&&(h("chat"),x("anon"),I(s),T("Anonymous"),w([]),M(""),e.emit("chat:join",{room:s}),o.ZP.success("Anonymous chat matched"))},a=()=>{L(!0),(0,o.ZP)("Searching partner...")},l=e=>{let{room:s}=e;_(!1),s&&(h("video"),b("anon"),o.ZP.success("Anonymous video matched"),t.push("/room/".concat(s)))},i=()=>{_(!0),(0,o.ZP)("Searching partner...")},c=e=>{let{room:t,count:s}=e;t===r&&D("number"==typeof s?s:0)},u=t=>{let{from:s,room:a}=t,l=(null!=a?a:"").trim();l&&(0,o.ZP)(t=>(0,n.jsxs)("div",{className:"panel",style:{padding:12},children:[(0,n.jsxs)("div",{style:{fontSize:14,marginBottom:10},children:["Chat invite from ",(0,n.jsx)("strong",{children:null!=s?s:"Someone"})]}),(0,n.jsxs)("div",{className:"buttonRow",style:{marginTop:0},children:[(0,n.jsx)("button",{className:"buttonPrimary",type:"button",onClick:()=>{o.ZP.dismiss(t.id),h("chat"),x("active"),I(l),T(null!=s?s:"Chat"),w([]),e.emit("chat:join",{room:l})},children:"Join"}),(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:()=>o.ZP.dismiss(t.id),children:"Ignore"})]})]}))},d=e=>{let{from:s,room:a}=e,l=(null!=a?a:"").trim();l&&(0,o.ZP)(e=>(0,n.jsxs)("div",{className:"panel",style:{padding:12},children:[(0,n.jsxs)("div",{style:{fontSize:14,marginBottom:10},children:["Video invite from ",(0,n.jsx)("strong",{children:null!=s?s:"Someone"})]}),(0,n.jsxs)("div",{className:"buttonRow",style:{marginTop:0},children:[(0,n.jsx)("button",{className:"buttonPrimary",type:"button",onClick:()=>{o.ZP.dismiss(e.id),t.push("/room/".concat(l))},children:"Join"}),(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:()=>o.ZP.dismiss(e.id),children:"Ignore"})]})]}))};return e.on("anon:chat:matched",s),e.on("anon:chat:searching",a),e.on("anon:video:matched",l),e.on("anon:video:searching",i),e.on("anon:chat:count",c),e.on("chat:invite",u),e.on("video:invite",d),()=>{e.off("anon:chat:matched",s),e.off("anon:chat:searching",a),e.off("anon:video:matched",l),e.off("anon:video:searching",i),e.off("anon:chat:count",c),e.off("chat:invite",u),e.off("video:invite",d)}},[t,e]);let Q=(0,a.useCallback)(e=>{if(e.preventDefault(),!V){o.ZP.error("Enter username first");return}if(!F){o.ZP.error("Enter room id");return}t.push("/room/".concat(F))},[t,V,F]),X=(0,a.useCallback)(t=>{if(!V){o.ZP.error("Enter username first");return}let s=(null!=t?t:"").trim();if(!s)return;let n="dm:".concat([V,s].sort().join("|"));I(n),T(s),w([]),x("active"),e.emit("chat:invite",{toEmail:s,room:n}),e.emit("chat:join",{room:n})},[V,e]),Y=(0,a.useCallback)(t=>{if(t.preventDefault(),!A)return;let s=(null!=Z?Z:"").trim();s&&(e.emit("chat:message",{room:A,message:s}),M(""))},[A,Z,e]),$=(0,a.useCallback)(()=>{if(!V){o.ZP.error("Enter username first");return}I(null),T(null),w([]),M(""),x("anon"),I(r),T("Anonymous"),e.emit("chat:join",{room:r})},[V,e]),ee=(0,a.useCallback)(()=>{L(!1),I(null),T(null),w([]),M(""),D(0),e.emit("anon:chat:leave")},[e]),et=(0,a.useCallback)(()=>{if(!V){o.ZP.error("Enter username first");return}b("anon"),e.emit("anon:video:find")},[V,e]),es=(0,a.useCallback)(()=>{_(!1),e.emit("anon:video:leave")},[e]),en=(0,a.useCallback)(s=>{if(!V){o.ZP.error("Enter username first");return}let n=(null!=s?s:"").trim();if(!n)return;let a="call-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2,6));e.emit("video:invite",{toEmail:n,room:a}),o.ZP.success("Invite sent"),t.push("/room/".concat(a))},[t,V,e]);return(0,n.jsx)("div",{className:"streamInterface",children:V?(0,n.jsxs)("div",{className:"streamContent",children:[(0,n.jsxs)("div",{className:"segmentRow",style:{marginBottom:16},children:[(0,n.jsx)("button",{className:"segmentButton ".concat("chat"===s?"segmentButtonActive":""),type:"button",onClick:()=>h("chat"),children:"Chat"}),(0,n.jsx)("button",{className:"segmentButton ".concat("video"===s?"segmentButtonActive":""),type:"button",onClick:()=>h("video"),children:"Video"})]}),"chat"===s&&(0,n.jsxs)("div",{className:"panel",children:[(0,n.jsx)("div",{className:"panelBody",style:{paddingBottom:8},children:(0,n.jsxs)("div",{className:"segmentRow",style:{margin:0},children:[(0,n.jsx)("button",{className:"segmentButton ".concat("active"===v?"segmentButtonActive":""),type:"button",onClick:()=>{L(!1),x("active"),A===r&&(I(null),T(null),w([]),M(""),e.emit("anon:chat:leave"))},children:"Active Users"}),(0,n.jsx)("button",{className:"segmentButton ".concat("anon"===v?"segmentButtonActive":""),type:"button",onClick:()=>{L(!1),x("anon"),I(null),T(null),w([]),M("")},children:"Anonymous"})]})}),"active"===v?(0,n.jsxs)("div",{className:"splitPane",style:{minHeight:400},children:[(0,n.jsxs)("div",{className:"listPane",children:[(0,n.jsxs)("div",{className:"listHeader",children:[(0,n.jsx)("h3",{className:"listTitle",children:"Active Users"}),(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:()=>e.emit("users:list"),children:"Refresh"})]}),(0,n.jsx)("div",{className:"userList",children:z.length?z.map(e=>(0,n.jsx)("button",{className:"userItem ".concat(R===e?"userItemActive":""),type:"button",onClick:()=>X(e),children:e},e)):(0,n.jsx)("div",{className:"smallText",children:"No active users yet."})})]}),(0,n.jsxs)("div",{className:"chatPane",children:[(0,n.jsxs)("div",{className:"chatHeader",children:[(0,n.jsx)("h3",{className:"chatTitle",children:R?"Chat with ".concat(R):"Select a user"}),(0,n.jsx)("span",{className:"badge",children:A?"Ready":"Idle"})]}),(0,n.jsx)("div",{className:"chatMessages",children:A?E.length?E.map((e,t)=>{var s;return(0,n.jsxs)("div",{className:"chatBubble ".concat(e.fromId&&e.fromId===S?"chatBubbleMe":""),children:[(0,n.jsx)("div",{className:"chatMeta",children:e.fromId&&e.fromId===S?"Me":e.from}),(0,n.jsx)("div",{children:e.message})]},"".concat(null!==(s=e.at)&&void 0!==s?s:"x","-").concat(t))}):(0,n.jsx)("div",{className:"smallText",children:"Say hi"}):(0,n.jsx)("div",{className:"smallText",children:"Pick someone from the left."})}),(0,n.jsxs)("form",{className:"chatInputRow",onSubmit:Y,children:[(0,n.jsx)("input",{className:"input",value:Z,onChange:e=>M(e.target.value),placeholder:A?"Type a message...":"Select a user to start",disabled:!A}),(0,n.jsx)("button",{className:"buttonPrimary",type:"submit",disabled:!A,children:"Send"})]})]})]}):(0,n.jsxs)("div",{className:"panelBody",children:[(0,n.jsxs)("div",{className:"statusRow",children:[(0,n.jsx)("span",{className:"badge",children:A?"Live":"Idle"}),A?(0,n.jsxs)("span",{className:"badge badgeOk",children:["Users: ",O]}):null]}),(0,n.jsx)("div",{className:"buttonRow",children:A?(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:ee,children:"Leave"}):(0,n.jsx)("button",{className:"buttonPrimary",type:"button",onClick:$,children:"Join Anonymous Chat"})}),A&&(0,n.jsx)("div",{className:"panel",style:{marginTop:14},children:(0,n.jsxs)("div",{className:"chatPane",children:[(0,n.jsxs)("div",{className:"chatHeader",children:[(0,n.jsx)("h3",{className:"chatTitle",children:"Anonymous Chat"}),(0,n.jsx)("span",{className:"badge badgeOk",children:"Live"})]}),(0,n.jsx)("div",{className:"chatMessages",children:E.length?E.map((e,t)=>{var s;return(0,n.jsxs)("div",{className:"chatBubble ".concat(e.fromId&&e.fromId===S?"chatBubbleMe":""),children:[(0,n.jsx)("div",{className:"chatMeta",children:e.fromId&&e.fromId===S?"Me":e.from}),(0,n.jsx)("div",{children:e.message})]},"".concat(null!==(s=e.at)&&void 0!==s?s:"x","-").concat(t))}):(0,n.jsx)("div",{className:"smallText",children:"Say hi"})}),(0,n.jsxs)("form",{className:"chatInputRow",onSubmit:Y,children:[(0,n.jsx)("input",{className:"input",value:Z,onChange:e=>M(e.target.value),placeholder:"Type a message..."}),(0,n.jsx)("button",{className:"buttonPrimary",type:"submit",children:"Send"})]})]})})]})]}),"video"===s&&(0,n.jsxs)("div",{className:"panel",children:[(0,n.jsx)("div",{className:"panelBody",style:{paddingBottom:8},children:(0,n.jsxs)("div",{className:"segmentRow",style:{margin:0},children:[(0,n.jsx)("button",{className:"segmentButton ".concat("users"===f?"segmentButtonActive":""),type:"button",onClick:()=>b("users"),children:"Active Users"}),(0,n.jsx)("button",{className:"segmentButton ".concat("room"===f?"segmentButtonActive":""),type:"button",onClick:()=>b("room"),children:"Join Room"}),(0,n.jsx)("button",{className:"segmentButton ".concat("anon"===f?"segmentButtonActive":""),type:"button",onClick:()=>b("anon"),children:"Anonymous"})]})}),"users"===f?(0,n.jsxs)("div",{className:"splitPane",style:{minHeight:400},children:[(0,n.jsxs)("div",{className:"listPane",children:[(0,n.jsxs)("div",{className:"listHeader",children:[(0,n.jsxs)("h3",{className:"listTitle",children:["Active Users (",z.length,")"]}),(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:()=>e.emit("users:list"),children:"Refresh"})]}),(0,n.jsx)("div",{className:"userList",children:z.length?z.map(e=>(0,n.jsx)("button",{className:"userItem",type:"button",onClick:()=>en(e),children:e},e)):(0,n.jsx)("div",{className:"smallText",children:"No active users yet."})})]}),(0,n.jsxs)("div",{className:"chatPane",children:[(0,n.jsxs)("div",{className:"chatHeader",children:[(0,n.jsx)("h3",{className:"chatTitle",children:"Start a call"}),(0,n.jsx)("span",{className:"badge",children:g?"Online":"Offline"})]}),(0,n.jsxs)("div",{className:"chatMessages",children:[(0,n.jsx)("div",{className:"smallText",children:"Click a user on the left to send an invite and create a private video room."}),(0,n.jsx)("div",{className:"smallText",style:{marginTop:10},children:"If you receive an invite, use the Join button in the popup."})]}),(0,n.jsxs)("div",{className:"chatInputRow",children:[(0,n.jsx)("input",{className:"input",disabled:!0,value:"Invites create a unique room automatically."}),(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:()=>e.emit("users:list"),children:"Refresh"})]})]})]}):"room"===f?(0,n.jsxs)("div",{className:"panelBody",children:[(0,n.jsxs)("form",{className:"form",onSubmit:Q,children:[(0,n.jsxs)("div",{className:"field",children:[(0,n.jsx)("label",{className:"label",htmlFor:"room",children:"Room ID"}),(0,n.jsx)("input",{id:"room",className:"input",value:p,onChange:e=>y(e.target.value),placeholder:"Enter room ID"})]}),(0,n.jsx)("div",{className:"buttonRow",children:(0,n.jsx)("button",{className:"buttonPrimary",type:"submit",children:"Join Video Room"})})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[(0,n.jsx)("h3",{className:"listTitle",style:{marginBottom:8},children:"Available Rooms"}),(0,n.jsx)("div",{className:"userList",children:q.length?q.map(e=>(0,n.jsx)("button",{className:"userItem",type:"button",onClick:()=>{y(e),t.push("/room/".concat(e))},children:e},e)):(0,n.jsx)("div",{className:"smallText",children:"No active rooms yet."})})]})]}):(0,n.jsxs)("div",{className:"panelBody",children:[(0,n.jsx)("div",{className:"statusRow",children:(0,n.jsx)("span",{className:"badge",children:U?"Searching...":"Idle"})}),(0,n.jsx)("div",{className:"buttonRow",children:U?(0,n.jsx)("button",{className:"buttonSecondary",type:"button",onClick:es,children:"Cancel Search"}):(0,n.jsx)("button",{className:"buttonPrimary",type:"button",onClick:et,children:"Start Anonymous Video Call"})}),(0,n.jsxs)("div",{className:"chatMessages",style:{marginTop:16},children:[(0,n.jsx)("div",{className:"smallText",children:"Click the button above to start searching for an anonymous video chat partner."}),(0,n.jsx)("div",{className:"smallText",style:{marginTop:10},children:"Once matched, you'll be redirected to a private video room."})]})]})]})]}):(0,n.jsx)("div",{className:"panel",children:(0,n.jsxs)("div",{className:"panelBody",children:[(0,n.jsxs)("header",{className:"lobbyHeader",children:[(0,n.jsx)("h1",{className:"lobbyTitle",children:"Welcome"}),(0,n.jsx)("p",{className:"lobbySubtitle",children:"Enter a username to access chat and video features."})]}),(0,n.jsxs)("form",{className:"form",onSubmit:W,children:[(0,n.jsxs)("div",{className:"field",children:[(0,n.jsx)("label",{className:"label",htmlFor:"username",children:"Username"}),(0,n.jsx)("input",{id:"username",className:"input",value:j,onChange:e=>N(e.target.value),placeholder:"Enter your username"})]}),(0,n.jsx)("div",{className:"buttonRow",children:(0,n.jsx)("button",{className:"buttonPrimary",type:"submit",disabled:!j.trim(),children:"Continue"})})]})]})})})}function v(){return(0,n.jsx)("div",{className:"dashboard",children:(0,n.jsx)("div",{className:"dashboard-content",children:(0,n.jsx)(h,{})})})}},2710:function(e,t,s){"use strict";s.d(t,{Z:function(){return c},s:function(){return o}});var n=s(7437),a=s(2265);let l=(0,s(5040).io)("",{path:"/api/socket"}),i=(0,a.createContext)(l),o=()=>(0,a.useContext)(i);function c(e){let{children:t}=e;return(0,n.jsx)(i.Provider,{value:l,children:t})}},6463:function(e,t,s){"use strict";var n=s(1169);s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}})}},function(e){e.O(0,[942,971,23,744],function(){return e(e.s=3351)}),_N_E=e.O()}]);